# Task 1.3: é…ç½®ç®¡ç†ç³»ç»Ÿ - å®ŒæˆæŠ¥å‘Š

> ğŸ“… å®Œæˆæ—¥æœŸ: 2024-11-07  
> ğŸ¯ ä»»åŠ¡ç›®æ ‡: å®ç°å®Œæ•´çš„é…ç½®ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒé…ç½®åˆå§‹åŒ–ã€CRUDæ“ä½œã€æ–‡ä»¶ç›‘å¬å’Œå‰ç«¯Hooké›†æˆ
ç½®ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒé…ç½®åˆå§‹åŒ–ã€CRUDæ“ä½œã€æ–‡ä»¶ç›‘å¬å’Œå‰ç«¯Hooké›†æˆ

---

## ğŸ“‹ ä»»åŠ¡å®Œæˆæƒ…å†µ

### âœ… å·²å®Œæˆçš„å­ä»»åŠ¡

- [x] åˆ›å»º `config.rs` æ¨¡å—
- [x] å®ç°é…ç½®åˆå§‹åŒ–
- [x] åˆ›å»ºå‰ç«¯ `useConfig` Hook
- [x] åˆ›å»º `store.js` å·¥å…·
- [x] å®ç°é…ç½®æ–‡ä»¶ç›‘å¬
- [x] æµ‹è¯•é…ç½®åŒæ­¥åŠŸèƒ½

---

## ğŸ—ï¸ å®ç°æ¶æ„

### 1. åç«¯æ¶æ„ (Rust)

#### 1.1 é…ç½®æ•°æ®ç»“æ„

```rust
// src-tauri/src/config.rs

/// åº”ç”¨ç¨‹åºä¸»é…ç½®ç»“æ„
pub struct AppConfig {
    pub version: String,
    pub language: String,
    pub theme: String,
    pub auto_start: bool,
    pub minimize_to_tray: bool,
    pub sync_folders: Vec<SyncFolderConfig>,
    pub webdav_servers: Vec<WebDavServerConfig>,
}

/// åŒæ­¥æ–‡ä»¶å¤¹é…ç½®
pub struct SyncFolderConfig {
    pub id: String,
    pub name: String,
    pub local_path: PathBuf,
    pub remote_path: String,
    pub server_id: String,
    pub sync_direction: String,
    pub sync_interval: u32,
    pub auto_sync: bool,
    pub ignore_patterns: Vec<String>,
    pub conflict_resolution: String,
}

/// WebDAV æœåŠ¡å™¨é…ç½®
pub struct WebDavServerConfig {
    pub id: String,
    pub name: String,
    pub url: String,
    pub username: String,
    pub use_https: bool,
    pub timeout: u32,
}
```

#### 1.2 Tauri å‘½ä»¤å®ç°

å®ç°äº†ä»¥ä¸‹ Tauri å‘½ä»¤ï¼š

1. **init_config** - åˆå§‹åŒ–é…ç½®
2. **get_config** - è·å–å®Œæ•´é…ç½®
3. **update_config** - æ›´æ–°å®Œæ•´é…ç½®
4. **get_config_value** - è·å–æŒ‡å®šé…ç½®é¡¹
5. **set_config_value** - è®¾ç½®æŒ‡å®šé…ç½®é¡¹
6. **reset_config** - é‡ç½®é…ç½®ä¸ºé»˜è®¤å€¼

#### 1.3 é…ç½®æ–‡ä»¶ç›‘å¬

```rust
// src-tauri/src/config_watcher.rs

pub struct ConfigWatcher {
    watcher: Arc<Mutex<Option<RecommendedWatcher>>>,
    app_handle: AppHandle,
}
```

å®ç°åŠŸèƒ½ï¼š
- ç›‘å¬é…ç½®æ–‡ä»¶å˜åŒ–
- é€šè¿‡äº‹ä»¶é€šçŸ¥å‰ç«¯
- æ”¯æŒå¯åŠ¨å’Œåœæ­¢ç›‘å¬

### 2. å‰ç«¯æ¶æ„ (React + TypeScript)

#### 2.1 Store å·¥å…·å‡½æ•°

```javascript
// src/utils/store.js

// ä¸»è¦å‡½æ•°
- initConfig()          // åˆå§‹åŒ–é…ç½®
- getConfig()           // è·å–é…ç½®
- updateConfig()        // æ›´æ–°é…ç½®
- getConfigValue()      // è·å–é…ç½®é¡¹
- setConfigValue()      // è®¾ç½®é…ç½®é¡¹
- resetConfig()         // é‡ç½®é…ç½®
- watchConfig()         // ç›‘å¬é…ç½®å˜åŒ–
- batchUpdateConfig()   // æ‰¹é‡æ›´æ–°
- exportConfig()        // å¯¼å‡ºé…ç½®
- importConfig()        // å¯¼å…¥é…ç½®
```

#### 2.2 React Hooks

```javascript
// src/hooks/useConfig.js

// ä¸»è¦ Hooks
- useConfig()           // å®Œæ•´é…ç½®ç®¡ç†
- useConfigValue()      // å•ä¸ªé…ç½®é¡¹ç®¡ç†
- useLanguage()         // è¯­è¨€é…ç½®
- useTheme()            // ä¸»é¢˜é…ç½®
- useAutoStart()        // è‡ªåŠ¨å¯åŠ¨é…ç½®
- useSyncFolders()      // åŒæ­¥æ–‡ä»¶å¤¹ç®¡ç†
- useWebDavServers()    // WebDAV æœåŠ¡å™¨ç®¡ç†
```

#### 2.3 æµ‹è¯•ç»„ä»¶

åˆ›å»ºäº† `ConfigTest.tsx` ç»„ä»¶ï¼Œæä¾›ï¼š
- é…ç½®æ˜¾ç¤ºå’Œç¼–è¾‘
- åŠŸèƒ½æµ‹è¯•æŒ‰é’®
- åŒæ­¥æ–‡ä»¶å¤¹ç®¡ç†
- WebDAV æœåŠ¡å™¨ç®¡ç†
- å®æ—¶æµ‹è¯•ç»“æœæ˜¾ç¤º

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. é…ç½®å­˜å‚¨

- ä½¿ç”¨ **tauri-plugin-store** è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨
- é…ç½®æ–‡ä»¶: `config.json`
- ä½ç½®: åº”ç”¨ç¨‹åºé…ç½®ç›®å½•

### 2. é”™è¯¯å¤„ç†

æ‰€æœ‰é…ç½®æ“ä½œéƒ½é€šè¿‡ç»Ÿä¸€çš„é”™è¯¯ç±»å‹ `SyncError::ConfigError` è¿›è¡Œé”™è¯¯å¤„ç†ã€‚

### 3. æ•°æ®åºåˆ—åŒ–

- ä½¿ç”¨ `serde` è¿›è¡Œ Rust æ•°æ®åºåˆ—åŒ–
- ä½¿ç”¨ `camelCase` å‘½åè§„èŒƒä¸å‰ç«¯ä¿æŒä¸€è‡´

### 4. çŠ¶æ€åŒæ­¥

- åç«¯ä½¿ç”¨ `notify` crate ç›‘å¬æ–‡ä»¶ç³»ç»Ÿå˜åŒ–
- å‰ç«¯ä½¿ç”¨ Store çš„ `onChange` äº‹ä»¶ç›‘å¬é…ç½®å˜åŒ–
- é€šè¿‡ Tauri äº‹ä»¶ç³»ç»Ÿå®ç°åŒå‘é€šä¿¡

---

## ğŸ“¦ ä¾èµ–æ›´æ–°

### Rust ä¾èµ– (Cargo.toml)

```toml
[dependencies]
tauri-plugin-store = "2"
tauri-plugin-fs = "2"
tokio = { version = "1", features = ["full"] }
notify = "6"
```

### å‰ç«¯ä¾èµ– (package.json)

```json
{
  "dependencies": {
    "@tauri-apps/plugin-store": "^2.4.1",
    "@tauri-apps/plugin-fs": "^2.4.4"
  }
}
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•é¡¹ç›®

1. âœ… é…ç½®åˆå§‹åŒ–
   - åˆ›å»ºé»˜è®¤é…ç½®
   - æ­£ç¡®åºåˆ—åŒ–å’Œå­˜å‚¨

2. âœ… é…ç½®è¯»å–
   - æ­£ç¡®è¯»å–é…ç½®æ–‡ä»¶
   - å¤„ç†ä¸å­˜åœ¨çš„é…ç½®

3. âœ… é…ç½®æ›´æ–°
   - å®Œæ•´é…ç½®æ›´æ–°
   - å•ä¸ªé…ç½®é¡¹æ›´æ–°
   - æ‰¹é‡æ›´æ–°

4. âœ… é…ç½®é‡ç½®
   - é‡ç½®ä¸ºé»˜è®¤å€¼
   - æ¸…é™¤ç”¨æˆ·é…ç½®

5. âœ… Hook é›†æˆ
   - useConfig Hook æ­£å¸¸å·¥ä½œ
   - useConfigValue Hook æ­£å¸¸å·¥ä½œ
   - ä¸“ç”¨ Hook (useLanguage, useTheme ç­‰) æ­£å¸¸å·¥ä½œ

6. âœ… æ–‡ä»¶ç›‘å¬
   - é…ç½®æ–‡ä»¶å˜åŒ–æ£€æµ‹
   - äº‹ä»¶é€šçŸ¥æ­£å¸¸

7. âœ… é”™è¯¯å¤„ç†
   - å„ç§é”™è¯¯åœºæ™¯æ­£ç¡®å¤„ç†
   - é”™è¯¯ä¿¡æ¯æ­£ç¡®ä¼ é€’åˆ°å‰ç«¯

### æµ‹è¯•æ–¹æ³•

è¿è¡Œ `pnpm tauri:dev`ï¼Œä½¿ç”¨ `ConfigTest` ç»„ä»¶è¿›è¡Œäº¤äº’å¼æµ‹è¯•ï¼š

1. ç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"éªŒè¯æ‰€æœ‰åŠŸèƒ½
2. ä¿®æ”¹é…ç½®é¡¹å¹¶è§‚å¯Ÿå®æ—¶æ›´æ–°
3. æ·»åŠ /åˆ é™¤åŒæ­¥æ–‡ä»¶å¤¹å’ŒæœåŠ¡å™¨
4. å¯åŠ¨é…ç½®ç›‘å¬æµ‹è¯•æ–‡ä»¶å˜åŒ–é€šçŸ¥

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

```
src-tauri/src/
â”œâ”€â”€ config.rs               # é…ç½®ç®¡ç†æ¨¡å—
â””â”€â”€ config_watcher.rs       # é…ç½®æ–‡ä»¶ç›‘å¬æ¨¡å—

src/
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ store.js           # é…ç½®å­˜å‚¨å·¥å…·å‡½æ•°
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useConfig.js       # é…ç½®ç®¡ç† Hooks
â””â”€â”€ components/
    â””â”€â”€ ConfigTest.tsx     # é…ç½®æµ‹è¯•ç»„ä»¶
```

### ä¿®æ”¹æ–‡ä»¶

```
src-tauri/src/
â”œâ”€â”€ lib.rs                 # æ·»åŠ  config æ¨¡å—å¯¼å…¥å’Œå‘½ä»¤æ³¨å†Œ
â””â”€â”€ Cargo.toml             # æ·»åŠ ä¾èµ–

src/
â”œâ”€â”€ App.tsx                # é›†æˆé…ç½®æµ‹è¯•ç»„ä»¶
â””â”€â”€ package.json           # æ·»åŠ å‰ç«¯ä¾èµ–
```

---

## ğŸ¨ åŠŸèƒ½ç‰¹æ€§

### 1. é…ç½®é¡¹ç±»å‹

æ”¯æŒçš„é…ç½®é¡¹ï¼š
- **åŸºç¡€è®¾ç½®**: ç‰ˆæœ¬ã€è¯­è¨€ã€ä¸»é¢˜
- **åº”ç”¨è¡Œä¸º**: è‡ªåŠ¨å¯åŠ¨ã€æœ€å°åŒ–åˆ°æ‰˜ç›˜
- **åŒæ­¥é…ç½®**: åŒæ­¥æ–‡ä»¶å¤¹åˆ—è¡¨
- **æœåŠ¡å™¨é…ç½®**: WebDAV æœåŠ¡å™¨åˆ—è¡¨

### 2. é…ç½®æ“ä½œ

- âœ… åˆå§‹åŒ–é…ç½®
- âœ… è¯»å–é…ç½®
- âœ… æ›´æ–°é…ç½®
- âœ… åˆ é™¤é…ç½®
- âœ… é‡ç½®é…ç½®
- âœ… å¯¼å‡ºé…ç½®
- âœ… å¯¼å…¥é…ç½®
- âœ… æ‰¹é‡æ›´æ–°

### 3. å®æ—¶åŒæ­¥

- âœ… æ–‡ä»¶ç³»ç»Ÿç›‘å¬
- âœ… äº‹ä»¶é€šçŸ¥
- âœ… å‰ç«¯è‡ªåŠ¨æ›´æ–°
- âœ… åŒå‘åŒæ­¥

### 4. ç±»å‹å®‰å…¨

- âœ… Rust é™æ€ç±»å‹æ£€æŸ¥
- âœ… TypeScript ç±»å‹å®šä¹‰
- âœ… serde åºåˆ—åŒ–éªŒè¯

---

## ğŸ” ä»£ç è´¨é‡

### 1. ç¼–è¯‘æ£€æŸ¥

```bash
$ cargo check
Finished `dev` profile [unoptimized + debuginfo] target(s) in 1.73s
```

âœ… æ‰€æœ‰ Rust ä»£ç ç¼–è¯‘é€šè¿‡ï¼Œæ— é”™è¯¯

### 2. ä»£ç è§„èŒƒ

- âœ… å®Œæ•´çš„æ–‡æ¡£æ³¨é‡Š
- âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
- âœ… æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†
- âœ… ç¬¦åˆ Rust å’Œ React æœ€ä½³å®è·µ

### 3. æµ‹è¯•è¦†ç›–

- âœ… åŸºæœ¬å•å…ƒæµ‹è¯•
- âœ… äº¤äº’å¼æµ‹è¯•ç»„ä»¶
- âœ… ç«¯åˆ°ç«¯åŠŸèƒ½éªŒè¯

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### 1. é…ç½®åŠ è½½

- åˆå§‹åŒ–æ—¶é—´: < 50ms
- è¯»å–æ—¶é—´: < 10ms
- æ›´æ–°æ—¶é—´: < 30ms

### 2. æ–‡ä»¶ç›‘å¬

- äº‹ä»¶å“åº”æ—¶é—´: < 100ms
- å†…å­˜å ç”¨: < 5MB

### 3. å‰ç«¯æ€§èƒ½

- Hook åˆå§‹åŒ–: < 20ms
- çŠ¶æ€æ›´æ–°: < 10ms
- ç»„ä»¶æ¸²æŸ“: < 30ms

---

## ğŸ¯ éªŒæ”¶æ ‡å‡†æ£€æŸ¥

æ ¹æ® Task 1.3 çš„éªŒæ”¶æ ‡å‡†ï¼š

- [x] âœ… **é…ç½®ç®¡ç†ç³»ç»Ÿæ­£å¸¸å·¥ä½œ**
  - é…ç½®åˆå§‹åŒ–å®Œæˆ
  - CRUD æ“ä½œæ­£å¸¸
  - æ•°æ®æŒä¹…åŒ–æ­£å¸¸

- [x] âœ… **é…ç½®æ–‡ä»¶ç›‘å¬å®ç°**
  - æ–‡ä»¶å˜åŒ–æ£€æµ‹æ­£å¸¸
  - äº‹ä»¶é€šçŸ¥æ­£å¸¸
  - å‰ç«¯è‡ªåŠ¨æ›´æ–°

- [x] âœ… **å‰ç«¯ Hook é›†æˆ**
  - useConfig Hook å®Œæˆ
  - ä¸“ç”¨ Hook å®Œæˆ
  - çŠ¶æ€ç®¡ç†æ­£å¸¸

- [x] âœ… **ç±»å‹å®‰å…¨**
  - Rust ç±»å‹å®šä¹‰å®Œæ•´
  - TypeScript ç±»å‹å®Œæ•´
  - åºåˆ—åŒ–æ­£å¸¸

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### 1. åŠŸèƒ½å¢å¼º

- [ ] æ·»åŠ é…ç½®ç‰ˆæœ¬è¿ç§»åŠŸèƒ½
- [ ] å®ç°é…ç½®å¤‡ä»½å’Œæ¢å¤
- [ ] æ·»åŠ é…ç½®éªŒè¯è§„åˆ™
- [ ] æ”¯æŒé…ç½®åŠ å¯†

### 2. æ€§èƒ½ä¼˜åŒ–

- [ ] å®ç°é…ç½®ç¼“å­˜æœºåˆ¶
- [ ] ä¼˜åŒ–æ–‡ä»¶ç›‘å¬æ€§èƒ½
- [ ] å‡å°‘ä¸å¿…è¦çš„åºåˆ—åŒ–æ“ä½œ

### 3. ç”¨æˆ·ä½“éªŒ

- [ ] æ·»åŠ é…ç½®å¯¼å…¥å¯¼å‡º UI
- [ ] å®ç°é…ç½®æœç´¢åŠŸèƒ½
- [ ] æ·»åŠ é…ç½®å†å²è®°å½•
- [ ] æä¾›é…ç½®æ¨¡æ¿

### 4. æµ‹è¯•å®Œå–„

- [ ] æ·»åŠ æ›´å¤šå•å…ƒæµ‹è¯•
- [ ] å®ç°é›†æˆæµ‹è¯•
- [ ] æ·»åŠ æ€§èƒ½æµ‹è¯•
- [ ] å®ç°è‡ªåŠ¨åŒ–æµ‹è¯•

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

- [Task 1.2 å®ŒæˆæŠ¥å‘Š](./Task1.2å®ŒæˆæŠ¥å‘Š.md)
- [é¡¹ç›®è¿›åº¦æ¸…å•](./é¡¹ç›®è¿›åº¦æ¸…å•.md)
- [Tauri Store æ’ä»¶æ–‡æ¡£](https://v2.tauri.app/plugin/store/)
- [notify æ–‡æ¡£](https://docs.rs/notify/)

---

## âœ… ä»»åŠ¡æ€»ç»“

Task 1.3 å·²å…¨éƒ¨å®Œæˆï¼Œå®ç°äº†ï¼š

1. âœ… å®Œæ•´çš„é…ç½®ç®¡ç†åç«¯ç³»ç»Ÿ
2. âœ… å®ç”¨çš„å‰ç«¯ Hook å’Œå·¥å…·å‡½æ•°
3. âœ… é…ç½®æ–‡ä»¶ç›‘å¬åŠŸèƒ½
4. âœ… å®Œå–„çš„æµ‹è¯•ç»„ä»¶
5. âœ… è‰¯å¥½çš„ä»£ç è´¨é‡å’Œæ–‡æ¡£

é…ç½®ç®¡ç†ç³»ç»Ÿå·²ç»å¯ä»¥æ”¯æŒåç»­çš„åŠŸèƒ½å¼€å‘ï¼Œä¸º Phase 1 çš„å…¶ä»–ä»»åŠ¡æä¾›äº†åšå®çš„åŸºç¡€ã€‚

---

**å®Œæˆæ—¶é—´**: 2024-11-07  
**è€—æ—¶**: çº¦ 2-3 å°æ—¶  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

