# å¸¸é‡ç®¡ç†æœ€ä½³å®è·µ

> ğŸ“… åˆ›å»ºæ—¥æœŸ: 2024-11-07  
> ğŸ¯ ç›®çš„: è¯´æ˜ LightSync é¡¹ç›®ä¸­çš„å¸¸é‡ç®¡ç†æ–¹æ¡ˆ

---

## ğŸ“– ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€ç®¡ç†å¸¸é‡ï¼Ÿ

### é—®é¢˜èƒŒæ™¯

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå¸¸é‡åˆ†æ•£åœ¨å„ä¸ªæ–‡ä»¶ä¸­ï¼Œä¼šå¯¼è‡´ï¼š

```rust
// âŒ ä¸å¥½çš„åšæ³• - å¸¸é‡åˆ†æ•£åœ¨å„ä¸ªæ–‡ä»¶ä¸­
// config.rs
const CONFIG_FILE: &str = "config.json";

// database.rs
const DB_FILE: &str = "lightsync.db";

// logger.rs
const LOG_FILE: &str = "lightsync.log";
```

**å­˜åœ¨çš„é—®é¢˜**ï¼š

- âŒ éš¾ä»¥æŸ¥æ‰¾å’Œä¿®æ”¹
- âŒ å¯èƒ½é‡å¤å®šä¹‰
- âŒ ç¼ºä¹ç»Ÿä¸€çš„å‘½åè§„èŒƒ
- âŒ ç»´æŠ¤æˆæœ¬é«˜

### è§£å†³æ–¹æ¡ˆ

åˆ›å»ºç»Ÿä¸€çš„ `constants.rs` æ¨¡å—ï¼š

```rust
// âœ… å¥½çš„åšæ³• - ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å¸¸é‡
// src-tauri/src/constants.rs

pub const CONFIG_STORE_FILE: &str = "config.json";
pub const DATABASE_FILE: &str = "lightsync.db";
pub const LOG_FILE: &str = "lightsync.log";
```

---

## ğŸ—ï¸ å¸¸é‡æ¨¡å—æ¶æ„

### æ–‡ä»¶ç»“æ„

```
src-tauri/src/
â”œâ”€â”€ constants.rs          # å¸¸é‡å®šä¹‰æ¨¡å—
â”œâ”€â”€ config.rs            # ä½¿ç”¨å¸¸é‡
â”œâ”€â”€ database.rs          # ä½¿ç”¨å¸¸é‡
â””â”€â”€ ...
```

### å¸¸é‡åˆ†ç±»

`constants.rs` æŒ‰åŠŸèƒ½åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

#### 1. æ–‡ä»¶åå¸¸é‡

```rust
pub const CONFIG_STORE_FILE: &str = "config.json";
pub const DATABASE_FILE: &str = "lightsync.db";
pub const LOG_FILE: &str = "lightsync.log";
```

#### 2. ç›®å½•åå¸¸é‡

```rust
pub const CACHE_DIR: &str = "cache";
pub const LOG_DIR: &str = "logs";
pub const TEMP_DIR: &str = "temp";
```

#### 3. é…ç½®é»˜è®¤å€¼

```rust
pub const DEFAULT_LANGUAGE: &str = "zh-CN";
pub const DEFAULT_THEME: &str = "system";
pub const DEFAULT_SYNC_INTERVAL: u32 = 30;
```

#### 4. åº”ç”¨ç¨‹åºä¿¡æ¯

```rust
pub const APP_NAME: &str = "LightSync";
pub const APP_VERSION: &str = env!("CARGO_PKG_VERSION");
pub const APP_DESCRIPTION: &str = env!("CARGO_PKG_DESCRIPTION");
```

#### 5. ç½‘ç»œç›¸å…³å¸¸é‡

```rust
pub const MAX_RETRY_COUNT: u32 = 3;
pub const RETRY_DELAY_MS: u64 = 1000;
pub const MAX_CONCURRENT_UPLOADS: usize = 5;
```

#### 6. æ–‡ä»¶å¤§å°é™åˆ¶

```rust
pub const SMALL_FILE_THRESHOLD: u64 = 1024 * 1024;      // 1MB
pub const MEDIUM_FILE_THRESHOLD: u64 = 100 * 1024 * 1024; // 100MB
```

#### 7. åŒæ­¥ç›¸å…³å¸¸é‡

```rust
pub const DEFAULT_IGNORE_PATTERNS: &[&str] = &[
    ".git",
    ".svn",
    "node_modules",
    "*.tmp",
];

pub mod sync_direction {
    pub const BIDIRECTIONAL: &str = "bidirectional";
    pub const UPLOAD_ONLY: &str = "upload-only";
    pub const DOWNLOAD_ONLY: &str = "download-only";
}
```

---

## ğŸ’¡ ä½¿ç”¨æ–¹æ³•

### 1. å¯¼å…¥å¸¸é‡

åœ¨éœ€è¦ä½¿ç”¨å¸¸é‡çš„æ¨¡å—ä¸­å¯¼å…¥ï¼š

```rust
// å¯¼å…¥æ‰€æœ‰å¸¸é‡
use crate::constants::*;

// æˆ–è€…åªå¯¼å…¥éœ€è¦çš„å¸¸é‡
use crate::constants::{CONFIG_STORE_FILE, DEFAULT_LANGUAGE};
```

### 2. ä½¿ç”¨å¸¸é‡

```rust
impl Default for AppConfig {
    fn default() -> Self {
        Self {
            version: APP_VERSION.to_string(),
            language: DEFAULT_LANGUAGE.to_string(),
            theme: DEFAULT_THEME.to_string(),
            // ...
        }
    }
}
```

### 3. ä½¿ç”¨å‘½åç©ºé—´å¸¸é‡

```rust
use crate::constants::sync_direction;

// ä½¿ç”¨æ—¶éœ€è¦åŠ ä¸Šæ¨¡å—å‰ç¼€
let direction = sync_direction::BIDIRECTIONAL;
```

---

## âœ… æœ€ä½³å®è·µ

### 1. å‘½åè§„èŒƒ

- âœ… ä½¿ç”¨ `UPPER_SNAKE_CASE` å‘½åå¸¸é‡
- âœ… ä½¿ç”¨æè¿°æ€§çš„åç§°
- âœ… åŒ…å«å•ä½ä¿¡æ¯ï¼ˆå¦‚ `_MS`, `_SECONDS`ï¼‰

```rust
// âœ… å¥½çš„å‘½å
pub const MAX_RETRY_COUNT: u32 = 3;
pub const RETRY_DELAY_MS: u64 = 1000;

// âŒ ä¸å¥½çš„å‘½å
pub const MAX: u32 = 3;
pub const DELAY: u64 = 1000;
```

### 2. åˆ†ç»„ç»„ç»‡

ä½¿ç”¨æ³¨é‡Šå’Œç©ºè¡Œå°†ç›¸å…³å¸¸é‡åˆ†ç»„ï¼š

```rust
// ============================================================================
// ç½‘ç»œç›¸å…³å¸¸é‡
// ============================================================================

/// æœ€å¤§é‡è¯•æ¬¡æ•°
pub const MAX_RETRY_COUNT: u32 = 3;

/// é‡è¯•å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
pub const RETRY_DELAY_MS: u64 = 1000;
```

### 3. æ·»åŠ æ–‡æ¡£æ³¨é‡Š

ä¸ºæ¯ä¸ªå¸¸é‡æ·»åŠ æ¸…æ™°çš„æ–‡æ¡£æ³¨é‡Šï¼š

```rust
/// å°æ–‡ä»¶é˜ˆå€¼ï¼ˆ1MBï¼‰- ä½¿ç”¨å®Œæ•´å“ˆå¸Œ
pub const SMALL_FILE_THRESHOLD: u64 = 1024 * 1024;
```

### 4. ä½¿ç”¨å‘½åç©ºé—´

å¯¹äºç›¸å…³çš„å¸¸é‡ç»„ï¼Œä½¿ç”¨å­æ¨¡å—ï¼š

```rust
pub mod sync_direction {
    pub const BIDIRECTIONAL: &str = "bidirectional";
    pub const UPLOAD_ONLY: &str = "upload-only";
    pub const DOWNLOAD_ONLY: &str = "download-only";
}
```

### 5. ç¯å¢ƒå˜é‡

ä½¿ç”¨ `env!` å®è¯»å–ç¼–è¯‘æ—¶ç¯å¢ƒå˜é‡ï¼š

```rust
pub const APP_VERSION: &str = env!("CARGO_PKG_VERSION");
pub const APP_DESCRIPTION: &str = env!("CARGO_PKG_DESCRIPTION");
```

### 6. å¤„ç†æœªä½¿ç”¨è­¦å‘Š

å¯¹äºä¸ºæœªæ¥åŠŸèƒ½é¢„ç•™çš„å¸¸é‡ï¼Œåœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ ï¼š

```rust
#![allow(dead_code)]
```

---

## ğŸ”„ è¿ç§»æ­¥éª¤

å¦‚æœéœ€è¦å°†ç°æœ‰å¸¸é‡è¿ç§»åˆ° `constants.rs`ï¼š

### æ­¥éª¤ 1: åˆ›å»º constants.rs

```bash
# åˆ›å»ºæ–‡ä»¶
touch src-tauri/src/constants.rs
```

### æ­¥éª¤ 2: ç§»åŠ¨å¸¸é‡å®šä¹‰

å°†å„ä¸ªæ–‡ä»¶ä¸­çš„å¸¸é‡ç§»åŠ¨åˆ° `constants.rs`ï¼š

```rust
// Before: config.rs
const CONFIG_FILE: &str = "config.json";

// After: constants.rs
pub const CONFIG_STORE_FILE: &str = "config.json";
```

### æ­¥éª¤ 3: åœ¨ lib.rs ä¸­æ³¨å†Œæ¨¡å—

```rust
// src-tauri/src/lib.rs
mod constants;
```

### æ­¥éª¤ 4: æ›´æ–°å¯¼å…¥

åœ¨ä½¿ç”¨å¸¸é‡çš„æ–‡ä»¶ä¸­æ·»åŠ å¯¼å…¥ï¼š

```rust
use crate::constants::*;
```

### æ­¥éª¤ 5: æ›´æ–°å¸¸é‡å¼•ç”¨

```rust
// Before
const CONFIG_FILE: &str = "config.json";
let store = app.store(CONFIG_FILE);

// After
use crate::constants::CONFIG_STORE_FILE;
let store = app.store(CONFIG_STORE_FILE);
```

### æ­¥éª¤ 6: æµ‹è¯•ç¼–è¯‘

```bash
cargo check
```

---

## ğŸ“Š æ•ˆæœå¯¹æ¯”

### Before (åˆ†æ•£ç®¡ç†)

```rust
// config.rs
const CONFIG_FILE: &str = "config.json";

// database.rs
const DB_FILE: &str = "lightsync.db";

// logger.rs
const LOG_FILE: &str = "lightsync.log";
const MAX_LOG_SIZE: u64 = 10 * 1024 * 1024;
```

**é—®é¢˜**ï¼š

- éš¾ä»¥æŸ¥æ‰¾æ‰€æœ‰é…ç½®æ–‡ä»¶å
- éœ€è¦æœç´¢å¤šä¸ªæ–‡ä»¶
- å¯èƒ½å­˜åœ¨é‡å¤æˆ–å†²çª

### After (ç»Ÿä¸€ç®¡ç†)

```rust
// constants.rs
pub const CONFIG_STORE_FILE: &str = "config.json";
pub const DATABASE_FILE: &str = "lightsync.db";
pub const LOG_FILE: &str = "lightsync.log";
pub const LOG_FILE_MAX_SIZE: u64 = 10 * 1024 * 1024;
```

**ä¼˜åŠ¿**ï¼š

- âœ… ä¸€ç›®äº†ç„¶
- âœ… æ˜“äºç»´æŠ¤
- âœ… ç»Ÿä¸€å‘½å
- âœ… é¿å…å†²çª

---

## ğŸ¯ å®é™…åº”ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: é…ç½®ç®¡ç†

```rust
// config.rs
use crate::constants::*;

impl Default for AppConfig {
    fn default() -> Self {
        Self {
            version: APP_VERSION.to_string(),
            language: DEFAULT_LANGUAGE.to_string(),
            theme: DEFAULT_THEME.to_string(),
            // ...
        }
    }
}
```

### ç¤ºä¾‹ 2: æ•°æ®åº“åˆå§‹åŒ–

```rust
// database.rs
use crate::constants::DATABASE_FILE;

pub async fn init_database(app: AppHandle) -> Result<()> {
    let db_path = app.path().app_data_dir()?.join(DATABASE_FILE);
    // ...
}
```

### ç¤ºä¾‹ 3: æ—¥å¿—ç³»ç»Ÿ

```rust
// logger.rs
use crate::constants::{LOG_FILE, LOG_FILE_MAX_SIZE, LOG_FILE_RETENTION};

pub fn setup_logger() -> Result<()> {
    let logger = FileLogger::new()
        .file_name(LOG_FILE)
        .max_size(LOG_FILE_MAX_SIZE)
        .retention(LOG_FILE_RETENTION);
    // ...
}
```

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: æ‰€æœ‰å¸¸é‡éƒ½è¦æ”¾åœ¨ constants.rs å—ï¼Ÿ

**A:** ä¸æ˜¯ã€‚æ ¹æ®å¸¸é‡çš„ä½¿ç”¨èŒƒå›´å†³å®šï¼š

- **å…¨å±€å…±äº«çš„å¸¸é‡** â†’ `constants.rs`
- **æ¨¡å—ç§æœ‰çš„å¸¸é‡** â†’ ä¿ç•™åœ¨æ¨¡å—å†…
- **ä¸´æ—¶çš„é­”æ•°** â†’ è€ƒè™‘æå–ä¸ºå‘½åå¸¸é‡

### Q2: å¸¸é‡å¤ªå¤šä¼šå¯¼è‡´æ–‡ä»¶è¿‡å¤§å—ï¼Ÿ

**A:** å¯ä»¥è¿›ä¸€æ­¥æ¨¡å—åŒ–ï¼š

```rust
// constants/mod.rs
pub mod files;
pub mod network;
pub mod database;

pub use files::*;
pub use network::*;
pub use database::*;
```

### Q3: å¦‚ä½•å¤„ç†ç¯å¢ƒç‰¹å®šçš„å¸¸é‡ï¼Ÿ

**A:** ä½¿ç”¨æ¡ä»¶ç¼–è¯‘ï¼š

```rust
#[cfg(debug_assertions)]
pub const API_URL: &str = "http://localhost:3000";

#[cfg(not(debug_assertions))]
pub const API_URL: &str = "https://api.example.com";
```

---

## âœ… æ£€æŸ¥æ¸…å•

åœ¨æ·»åŠ æ–°å¸¸é‡æ—¶ï¼Œæ£€æŸ¥ï¼š

- [ ] å¸¸é‡åç§°æ¸…æ™°ã€æè¿°æ€§å¼º
- [ ] ä½¿ç”¨äº†æ­£ç¡®çš„å‘½åè§„èŒƒï¼ˆUPPER_SNAKE_CASEï¼‰
- [ ] æ·»åŠ äº†æ–‡æ¡£æ³¨é‡Š
- [ ] æ”¾åœ¨äº†åˆé€‚çš„åˆ†ç»„ä¸­
- [ ] ç±»å‹æ­£ç¡®ï¼ˆ&str, u32, u64 ç­‰ï¼‰
- [ ] åŒ…å«äº†å•ä½ä¿¡æ¯ï¼ˆå¦‚æœé€‚ç”¨ï¼‰

---

## ğŸ“š ç›¸å…³èµ„æº

- [Rust å¸¸é‡æ–‡æ¡£](https://doc.rust-lang.org/book/ch03-01-variables-and-mutability.html#constants)
- [Rust å‘½åè§„èŒƒ](https://rust-lang.github.io/api-guidelines/naming.html)
- [é¡¹ç›®è¿›åº¦æ¸…å•](./é¡¹ç›®è¿›åº¦æ¸…å•.md)

---

**æ€»ç»“**: ç»Ÿä¸€ç®¡ç†å¸¸é‡æ˜¯ä¸€ä¸ªç®€å•ä½†æœ‰æ•ˆçš„è½¯ä»¶å·¥ç¨‹å®è·µï¼Œèƒ½å¤Ÿæ˜¾è‘—æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯è¯»æ€§ã€‚
